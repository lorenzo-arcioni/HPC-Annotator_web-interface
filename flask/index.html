<!DOCTYPE html>
<html>
    <head> 
        <meta charset="utf-8"> 
        <title> HPC-Annotator </title>

        <style>
                .software_setting, .wlm_setting{
                    margin: 20px;
                }

                .SWM{
                    padding-left: 10px;
                }

                .SAT{
                    padding-left: 10px;
                }

                .conf{
                    margin-left: 50px;
                    margin-right: 50px;
                    margin-bottom: 30px;
                    padding-bottom: 8px;
                    padding-left: 10px;
                    padding-right: 10px;
                }
                
                .center{
                    margin: 20px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }

                #sub_B, #reset{
                    padding: 10px;
                    font-size: 15px;

                }


        </style>

        <script>
		function initPage() {
			toggleConfigurationPanel();
			document.getElementById("sub_B").addEventListener("click", validateForm);
		}

		function toggleConfigurationPanel() {
			var slurmConfPanel = document.getElementById("slurmConfPanel");
			var htcondorConfPanel = document.getElementById("htcondorConfPanel");
			var noneConfPanel = document.getElementById("noneConfPanel");

			var slurmRadio = document.getElementById("slurm");
			var htcondorRadio = document.getElementById("htcondor");
			var noneRadio = document.getElementById("none");

			if (slurmRadio.checked) {
			    slurmConfPanel.style.display = "block";
			    htcondorConfPanel.style.display = "none";
			    noneConfPanel.style.display = "none";
			} else if (htcondorRadio.checked) {
			    slurmConfPanel.style.display = "none";
			    htcondorConfPanel.style.display = "block";
			    noneConfPanel.style.display = "none";
			} else if (noneRadio.checked) {
			    slurmConfPanel.style.display = "none";
			    htcondorConfPanel.style.display = "none";
			    noneConfPanel.style.display = "block";
			}
		}
		    
		function validateForm(){
			var form = document.querySelector("form");
			var inputs = form.querySelectorAll("input, select");
			var isValid = true;

			for (var i = 0; i < inputs.length; i++) {
			    var input = inputs[i];

			    if (input.offsetParent !== null && input.value.trim() === "") {
				isValid = false;
				input.style.backgroundColor = "#BDBDBD";
			    }
			    else{
			    	input.style.backgroundColor = ""
			    }
			}
			if (!isValid){
			    event.preventDefault();
			    window.alert("Please fill all field!");
			    exit(0)
			}
		    // Check if the outformat has the correct format with double quotes
		    var outformatInput = document.getElementById("outformat");

		    if (!outformatInput.value.match('\".*6 .*\"')) {
			isValid = false;
			outformatInput.style.backgroundColor = "#BDBDBD";
		    } else {
			outformatInput.style.backgroundColor = "";
		    }

			if (!isValid){
			    event.preventDefault();
			    window.alert("There is an error in the outformat.\nRemember the double quotes and the correct spaces.")
			}
		}
        </script>
        
    </head>
    <body onload="initPage()">

        <div class="titolo" style="text-align: center;">
            <h1>HPC-Annotator</h1>
            <h2 id="sottotitolo">Generative Interface</h2>
        </div>

        <div class="descrizione">
            <p style="text-align: center;">The aim of the project is to create a user interface that simplifies the configuration of HPC-Annotator software, which is a parallelization software for the main annotation software such as BLAST and Diamond, among others. 
                The interface should allow the user to customize the software settings in order to generate a software package with the desired specifications. 
                Once the software package is created, the user will be able to download it in TAR format and upload it onto the machine where the annotation will take place.</p>
        </div>
        
        <br>

        <form method="POST" id="form">
	<p style="text-align: center;">In this section, you can choose which workload manager to use (Slurm or HTCondor) or generate scripts without any workload manager. Please note that all required fields are mandatory.</p>
            <div class="wlm_setting" style="border: 2px solid black; padding: -3px">
                <div class="SWM">
                    <p style="margin-top: 4px; margin-left: -12px;"><span style="border: 2px solid black; padding: 4px;">Select workload manager</span></p></p>
                    <input type="radio" id="slurm" value="slurm" name="workload_manager" onchange="toggleConfigurationPanel()" onload="toggleConfigurationPanel()">
                    <label for="Slurm">Slurm</label>
                    <input type="radio" id="htcondor" value="htcondor" name="workload_manager" onchange="toggleConfigurationPanel()" onload="toggleConfigurationPanel()">
                    <label for="Slurm">HTCondor</label>
                    <input type="radio" id="none" value="none" name="workload_manager" checked onchange="toggleConfigurationPanel()" onload="toggleConfigurationPanel()">
                    <label for="Slurm">None</label><br><br><br>
                </div>
            
                <div class="conf" id="slurmConfPanel" style="border: 2px solid black; display: none;">
                    <div class="slurmconf">
                        <p style="margin-top: 4px;"><span style="border: 2px solid black; margin-left: -12px;padding: 4px; margin-top: 5px;">Slurm configuration settings</span></p>
                            
                        <label for="Slurm_account_name">Account name: </label>
                        <input type="text" name="Slurm_account_name" id="Slurm_account_name">
                        <label for="Spart">Serial partition: </label>
                        <input type="text" name="Slurm_serial_part" id="Slurm_serial_part">
                        <label for="Part">Parallel partition: </label>
                        <input type="text" name="Slurm_parallel_part" id="Slurm_parallel_part">
                        <br>
                        <br>
                        <label for="Nproces">Number of processes: </label>
                        <input type="number" name="Slurm_Nprocess" id="Slurm_Nprocess" style="width: 40px;" min=1 value=1>
                        <label for="Nthread">Number of threads: </label>
                        <input type="number" name="Slurm_Nthreads" id="Slurm_Nthreads" style="width: 40px;" min=1 value=1>
                        <label for="Time">Wall-time(hours): </label>
                        <input type="number" name="Slurm_time" id="Time" style="width: 40px;" min=1 value=1>
                        <label for="Mproces">Memory per process: </label>
                        <input type="number" name="Slurm_Mprocess" id="Mprocess" style="width: 40px;" min=1 value=1>
                    </div>
                </div>
            
                <div class="conf" id="htcondorConfPanel" style="border: 2px solid black; display: none;">
                    <p style="margin-top: 4px;"><span style="border: 2px solid black; margin-left: -12px;padding: 4px; margin-top: 5px;">HTCondor configuration settings</span></p>
                    Work in progress!
                    <!--
                    <label for="Aname">Account name: </label>
                    <input type="text" name="Aname" id="Aname">
                    <label for="Spart">Serial partition: </label>
                    <input type="text" name="Spart" id="Spart">
                    <label for="Part">Parallel partition: </label>
                    <input type="text" name="Part" id="Part">
                    <br>
                    <br>
                    <label for="Nproces">Number of processes: </label>
                    <input type="number" name="Nproces" id="Nproces" style="width: 40px;" min=1 value=1>
                    <label for="Nthread">Number of threads: </label>
                    <input type="number" name="Nthread" id="Nthread" style="width: 40px;" min=1 value=1>
                    <label for="Time">Wall-time(hours): </label>
                    <input type="number" name="Time" id="Time" style="width: 40px;" min=1 value=1>
                    <label for="Mproces">Memory per process: </label>
                    <input type="number" name="Mproces" id="Mproces" style="width: 40px;" min=1 value=1>
                    -->
                </div>

                <div class="conf" id="noneConfPanel" style="border: 2px solid black; display: block;">
                    <p style="margin-top: 4px;"><span style="border: 2px solid black; margin-left: -12px;padding: 4px; margin-top: 5px;">Base configuration settings</span></p>
                    
                    <label for="Nproces">Number of processes: </label>
                    <input type="number" name="Nprocess" id="Nprocess" style="width: 40px;" min=1 value=1>
                    <br>
                    <br>
                    <label for="Part">Threads</label>
                    <input type="number" name="threads" id="threads" style="width: 40px;" min=1 value=1>
                </div>

            </div>

            </div>
		<p style="text-align: center">In the section below, you can set the configuration of the annotation software you will be using. It is necessary to provide the binary path of the software, the input file path (in Multi-FASTA format), the reference database path, the output format to be used (for more information on the outformat, refer to the documentation of the annotation software), and any additional options to be passed to the software (for additional options, refer to the documentation of the annotation software). <p style="font-weight: bold;text-align: center;">Please note that it is absolutely mandatory to use the running machine absolute paths.</p>
		</p>
            <div class="software_setting" style="border: 2px solid black;">
                <div class="SAT">
                    <p style="margin-top: 4px; margin-left: -12px;"><span style="border: 2px solid black; padding: 4px;">Select the annotation tool</span></p></p>
                    <input type="radio" id="blast" value="blast" name="annotation_software">
                    <label for="Slurm">Blast</label>
                    <input type="radio" id="diamond" value="diamond" name="annotation_software" checked>
                    <label for="Slurm">Diamond</label>
                    <br><br><br>


                    <label for="tool-select">Choose a tool:</label>

                    <select name="tool" id="tool">
                        <option value="blastp">Blastp</option>
                        <option value="blastx">Blastx</option>
                    </select>
		    <br>
		    <br>
                    <label for="Part">Database path</label>
                    <input type="text" name="DB_path" id="DB_path" size="225">
                    <br>
                    <br>
                    <label for="Part">Input file path</label>
                    <input type="text" name="IF_path" id="IF_path" size="225">
                    <br>
                    <br>
                    <label for="Part">Binary path</label>
                    <input type="text" name="BI_path" id="BI_path" size="225">
                    <br>
                    <br>
                    <label for="Part">Outformat (please use the double quotes)</label>
                    <input type="text" name="outformat" id="outformat" size="225" value="&#34; 6 qseqid sseqid pident length mismatch gapopen qstart qend sstart send evalue bitscore &#34;">
                    <br>
                    <br>
                    <label for="Part">Additional options</label>
                    <input type="text" name="add_options" id="add_options" size="225" value="-k 10 --ultra-sensitive">
                    <br>
                    <br>

                </div>

            </div>

            <div class="center">
                <button id="reset" type="reset"> 
                    Clear and reset the fields
                </button>

                <button id="sub_B" type="submit"> 
                    Generate
                </button>
            </div>

        </form>

    
    </body>

    <footer>
        <!-- insert your code here-->
    </footer>
</html>
